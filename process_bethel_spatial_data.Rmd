---
title: "Download and process spatial data for Bethel, CT"
author: "Danielle Ferraro"
date: "8/3/2020"
output: html_document
---

# Introduction

Here I use the `tigris` package to download shapefiles from the US Census of Connecticut's roads and town boundaries.

# Setup

```{r}
library(here)
library(tidyverse)
library(sf)
library(tigris)
library(smoothr) 
```

# Read in data

I used the [tigris](https://github.com/walkerke/tigris) package to directly download TIGER/Line shapefiles of town boundaries and other data for Fairfield county. Note: TIGER stands for Topologically Integrated Geographic Encoding and Referencing and is the format used by the US Census Bureau. In addition to town boundaries, I also downloaded road and hydrography data. 
```{r}
# Census subdvisions, aka towns
fairfield_towns <- county_subdivisions(state = "CT", county = "Fairfield")

# Roads and rails
fairfield_roads <- roads(state = "CT", county = "Fairfield")
rails <- rails() # National dataset
fairfield_rails <- st_intersection(rails, fairfield_towns)

# Hydrology
fairfield_water_linear <- linear_water(state = "CT", county = "Fairfield")
fairfield_water_area <- area_water(state = "CT", county = "Fairfield")
```


I also defined a set of personal data points that I wanted to layer on top.
```{r}
our_places <- tibble(name = c("6 Terry Drive", "20 Cortland Drive"),
                     x = c(-73.394546, -73.382509),
                     y = c(41.387528, 41.403420)
)
```

# Subset data

Subset Bethel town boundary, and define bounding box coordinates to crop the other data prior to plotting. The area will include Bethel with a small buffer around it.
```{r}
bbox <- st_bbox(st_buffer(bethel_boundary, 0.01))

bethel_boundary <- filter(fairfield_towns, NAME == "Bethel")

bethel_roads <- st_crop(fairfield_roads, bbox)
bethel_water_linear <- st_crop(fairfield_water_linear, bbox)
bethel_water_area <- st_crop(fairfield_water_area, bbox)
bethel_rails <- st_crop(rails, bbox)
```

# Light data tweaking

Some of the water area polygons are quite jagged. 
```{r}
plot(bethel_water_area[1])
```

With the `smoothr::smooth()` function, I can smooth those polygons to make them a bit more aesthetically pleasing.
```{r}
bethel_water_area <- smooth(bethel_water_area, method = "chaikin")
plot(bethel_water_area[1])
```

# Plot

Choose a font for the plot title.
```{r}
library(showtext)
font_add_google(name = "Cormorant", family = "cormorant") # serif
font_add_google(name = "Montserrat", family  = "Montserrat") # sans serif
showtext_auto() # Loads the fonts
```

Plot:
```{r}
water_col <- "#BCCFD0" # pale blue
water_col <- "#7cc3c4" # bright turquoise
background_col <- "#7A7A7A" # dark gray
background_col <- "#2C3546" # deep gray/navy

ggplot() +
  
  # Water
  geom_sf(data = bethel_water_area, fill = water_col, color = NA) +
  geom_sf(data = bethel_water_linear, color = water_col, size = 0.7) +

  # Roads - make main roads darker and thicker
  geom_sf(data = bethel_roads %>% filter(RTTYP %in% c("I", "S")), fill = NA, color = "white", size = 0.6) + 
  geom_sf(data = bethel_roads %>% filter(!RTTYP %in% c("I", "S")), fill = NA, color = "white", size = 0.4) + 
  
  # Rails
  geom_sf(data = bethel_rails, linetype = "twodash", size = 1, color = "white") +
    
  # Town border
  geom_sf(data = bethel_boundary, size = 1, fill = NA, color = "#FFFFFF4D") + # Hex code refers to white, last two letters define the transparency
  
  # Personal points
  geom_point(data = our_places, aes(x = x, y = y), size = 1, color = "white") +
  geom_text(data = our_places, aes(x = x, y = y, label = name), size = 2.5, color = "white", fontface = "italic", hjust = -0.1) +
  
  # Add labels and theme
  #labs(caption = 'Bethel, Connecticut') +
  labs(caption = "BETHEL | CONNECTICUT") +
  theme_void() +
  theme(plot.caption = element_text(color = "white", size = 50, hjust = 0.5, family = "Montserrat"),
        plot.background = element_rect(fill = background_col))
```

# Save

```{r eval = FALSE}
ggsave(here("bethel.pdf"), width = 297, height = 420, units = "mm", dpi = "retina")
```